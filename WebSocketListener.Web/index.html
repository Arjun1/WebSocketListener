<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>WebSocket test</title>
    <link href="Content/default.css" rel="stylesheet" />
</head>
<body>
    <h2>WebSocket Test</h2>
    <p>The server will return the text reversed.</p>
    <div id="input">
        <textarea id="text" disabled></textarea>
        <button id="button" disabled>Reverse</button>
        <div id="characters1"></div>
        <div id="characters2"></div>
    </div>
    <div id="log">

    </div>

    <script>
        var button = document.getElementById('button');
        var text = document.getElementById('text'); 
        var log = document.getElementById('log');
        var characters1 = document.getElementById('characters1');
        var characters2 = document.getElementById('characters2');

        var ws = new WebSocket("ws://127.0.0.1:8001", "text");
        ws.onopen = function (event) {
            button.disabled = false;
            text.disabled = false;
            ws.send("Valeriano");
            ws.send("Valeriano");
            ws.send("Valeriano");
            ws.send("Valeriano");
            button.addEventListener('click', function () {
                if (text.value) {
                    characters1.textContent = text.value.length;
                    characters2.textContent = '';
                    ws.send(text.value);
                }
            }, false);
        };

        ws.onmessage = function (event) {
            var node = document.createElement('p');
            node.className = 'log-msg';
            node.textContent = event.data;
            log.appendChild(node);
            characters2.textContent = event.data.length;
        }

        ws.onclose = function (event) {
            button.disabled = true;
            text.disabled = true;
        };

        ws.onerror = function (event) {
            console.log(event.data);
        }
    </script>
</body>
</html>
